<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SkillSync | Resume Analyzer</title>
<link rel="stylesheet" href="./output.css">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body class="bg-gray-100 dark:bg-gray-900 min-h-screen flex justify-center items-center">

<div class="w-[900px] bg-white dark:bg-gray-800 p-8 rounded-2xl shadow-2xl">

<!-- Title -->
<h1 class="text-3xl font-bold text-gray-900 dark:text-white text-center">
üìÑ Resume Analyzer
</h1>

<p class="text-center text-gray-500 dark:text-gray-400 mb-6">
Upload your resume to analyze ATS score, strengths, weaknesses, suggestions & career roles
</p>

<!-- Upload -->
<input id="resumeFile"
type="file"
accept="application/pdf"
class="w-full bg-gray-200 dark:bg-gray-700 p-3 rounded-lg text-gray-900 dark:text-white">

<button id="uploadBtn"
class="mt-4 w-full bg-indigo-600 hover:bg-indigo-700 text-white p-3 rounded-lg">
Upload & Analyze
</button>

<!-- Extracted Text -->
<h2 class="text-xl text-gray-900 dark:text-white mt-6 mb-2">
Extracted Resume Text:
</h2>

<div id="resumeText"
class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg h-[200px] overflow-y-scroll text-gray-800 dark:text-white">
No resume uploaded yet...
</div>

<!-- ATS Section -->
<h2 class="text-xl text-gray-900 dark:text-white mt-6 mb-2">
ATS Analysis Result:
</h2>

<div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg text-gray-900 dark:text-white">

  <h3 class="text-lg font-semibold mb-2">
    ATS Score: <span id="atsScore" class="text-indigo-500 text-2xl">0</span>/100
  </h3>

  <h3 class="mt-4 font-semibold">üëç Strengths</h3>
  <ul id="prosList" class="list-disc ml-6 text-green-400"></ul>

  <h3 class="mt-4 font-semibold">‚ö† Weaknesses</h3>
  <ul id="consList" class="list-disc ml-6 text-yellow-400"></ul>

  <h3 class="mt-4 font-semibold">‚ú® Suggestions</h3>
  <ul id="suggestionsList" class="list-disc ml-6 text-blue-400"></ul>

</div>

<!-- Role Recommendation -->
<h2 class="text-xl text-gray-900 dark:text-white mt-6 mb-2">
Recommended Career Roles:
</h2>

<div id="roleBox" 
class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg text-gray-900 dark:text-white">
No analysis yet...
</div>

</div>


<!-- PDF JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

<script type="module">

import { auth, db } from "./firebase.js";
import { onAuthStateChanged } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { doc, setDoc } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

let currentUser = null;

// Auth Protection
onAuthStateChanged(auth, user =>{
 if(!user){
   alert("Login first");
   window.location.href="login.html";
 } 
 else currentUser = user.uid;
});

const uploadBtn = document.getElementById("uploadBtn");
const textBox = document.getElementById("resumeText");
const fileInput = document.getElementById("resumeFile");


// Upload + Extract
uploadBtn.addEventListener("click", async ()=>{

 if(!fileInput.files[0]) return alert("Upload PDF first");

 const file = fileInput.files[0];
 if(file.type !== "application/pdf") return alert("PDF only allowed");

 const reader = new FileReader();

 reader.onload = async () =>{

   const pdf = await pdfjsLib.getDocument(new Uint8Array(reader.result)).promise;
   let extractedText = "";

   for(let i=1; i<=pdf.numPages; i++){
     const page = await pdf.getPage(i);
     const text = await page.getTextContent();
     extractedText += text.items.map(item => item.str).join(" ") + "\n";
   }

   textBox.innerText = extractedText;

   analyzeResume(extractedText);

   await setDoc(doc(db,"resumes",currentUser),{
     text: extractedText,
     uploadedAt: new Date()
   });

   alert("Resume Uploaded & Analyzed Successfully ‚úî");
 };

 reader.readAsArrayBuffer(file);
});



// ========================= ATS ENGINE =========================
function analyzeResume(text){

 text = text.toLowerCase();

 let score = 50;
 let pros = [];
 let cons = [];
 let suggestions = [];


if(text.includes("project")){
  score += 12;
  pros.push("Resume contains impactful projects demonstrating hands-on capability.");
} else {
  cons.push("Projects are missing.");
  suggestions.push("Add 2‚Äì3 strong technical projects with measurable outcomes.");
}

if(text.includes("experience") || text.includes("internship")){
  score += 12;
  pros.push("Internship / Work experience improves credibility.");
} else {
  cons.push("No internship / job experience detected.");
  suggestions.push("Gain internships, open source contributions or freelancing experience.");
}

if(text.includes("education") || text.includes("btech")){
  score += 6;
  pros.push("Education section is clearly mentioned.");
} else {
  cons.push("Education details missing.");
}

if(text.includes("skills")){
  score += 12;
  pros.push("Skills section helps ATS identify competency.");
} else {
  cons.push("Skills section missing.");
  suggestions.push("Add Skills section with categorized skills.");
}

if(text.length > 1200){
  score += 10;
  pros.push("Resume length is sufficient and detailed.");
} else {
  cons.push("Resume seems too short.");
  suggestions.push("Add responsibilities, achievements and outcomes.");
}

if(text.includes("machine learning") || text.includes("ai") || text.includes("data science")){
  score += 8;
  pros.push("Resume clearly reflects AI / Data domain.");
}

if(text.includes("@") && text.includes("+91")){
  score += 5;
  pros.push("Contact details look valid.");
} else {
  cons.push("Contact details weak / missing.");
}

if(score > 100) score = 100;

// Save ATS Dashboard Data
const dashboardData = {
  atsScore: score,
  strengths: pros,
  weaknesses: cons,
  suggestions: suggestions,
  text: text
};

localStorage.setItem("skillsync_dashboard", JSON.stringify(dashboardData));
console.log("Dashboard analytics saved");


// UI Update
document.getElementById("atsScore").innerText = score;
document.getElementById("prosList").innerHTML = pros.map(p=>`<li>${p}</li>`).join("");
document.getElementById("consList").innerHTML = cons.length? cons.map(c=>`<li>${c}</li>`).join("") : "<li>No major weaknesses üéâ</li>";
document.getElementById("suggestionsList").innerHTML = suggestions.length? suggestions.map(s=>`<li>${s}</li>`).join("") : "<li>Looks great! üöÄ</li>";

recommendRoles(text);
}



// ========================= ROLE ENGINE =========================
function recommendRoles(text){

 let roles = [];

 function add(role, match, why, missing){
  roles.push(`
  <div class="mb-4 p-4 rounded-lg bg-gray-200 dark:bg-gray-800">
    <h3 class="text-lg font-semibold text-indigo-400">${role}</h3>
    <p>üéØ Match Score: <b>${match}%</b></p>
    <p class="mt-1 text-green-400">üü¢ Why Suitable:</p>
    <p class="ml-3">${why}</p>
    <p class="mt-2 text-yellow-400">‚ö† Missing Skills:</p>
    <p class="ml-3">${missing}</p>
  </div>
 `);
 }


if(text.includes("machine learning") || text.includes("ml") || text.includes("ai"))
 add("AI / Machine Learning Engineer",92,
 "Strong ML exposure detected including models, preprocessing and analytics.",
 "Deep Learning ‚Ä¢ TensorFlow/PyTorch ‚Ä¢ Deployment ‚Ä¢ MLOps");


if(text.includes("pandas") || text.includes("eda") || text.includes("data analysis"))
 add("Data Scientist",88,
 "Excellent analytics, data transformation and Python skills found.",
 "Statistics ‚Ä¢ Feature Engineering ‚Ä¢ Business Problem Solving");


if(text.includes("sql") || text.includes("analytics"))
 add("Data Analyst",85,
 "Good SQL + analytical thinking.",
 "PowerBI / Tableau ‚Ä¢ Reporting ‚Ä¢ Data Storytelling");


if(text.includes("backend") || text.includes("api"))
 add("Backend Developer",78,
 "Backend understanding detected.",
 "Scalable APIs ‚Ä¢ Authentication ‚Ä¢ Microservices");


if(text.includes("react") || text.includes("frontend") || text.includes("web"))
 add("Full Stack Developer",82,
 "Frontend + coding foundation makes this suitable.",
 "Advanced React ‚Ä¢ Optimization ‚Ä¢ Deployment");


if(roles.length===0)
 roles.push("<p>No strong role detected. Make your resume more domain-focused.</p>");

document.getElementById("roleBox").innerHTML = roles.join("");
}

</script>

</body>
</html>
